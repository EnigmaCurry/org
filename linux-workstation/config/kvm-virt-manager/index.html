<!DOCTYPE html>
<html lang="en-us" dir="ltr" itemscope itemtype="http://schema.org/Article">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="height=device-height, width=device-width, initial-scale=1.0, minimum-scale=1.0">
    <meta name="generator" content="Hugo 0.123.7">
    <meta name="generator" content="Relearn 6.0.0+tip">
    <meta name="description" content="You can bend the “no servers on workstations” rule, a bit, by hosting some development servers inside of virtual machines (VM) on your workstation. Keeping your development servers in isolated VMs, running under a dedicated VM user account, will keep your workstation clean. You can treat these VMs just like any other remote Linux host, and access them over SSH, and have them automatically start when your workstation boots.
These instructions will install a barebones Debian server in a VM, with NAT networking (private IP address, no public ports open), for local development/testing purposes only.">
    <meta name="author" content="">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="KVM / libvirt :: book.rymcg.tech">
    <meta name="twitter:description" content="You can bend the “no servers on workstations” rule, a bit, by hosting some development servers inside of virtual machines (VM) on your workstation. Keeping your development servers in isolated VMs, running under a dedicated VM user account, will keep your workstation clean. You can treat these VMs just like any other remote Linux host, and access them over SSH, and have them automatically start when your workstation boots.
These instructions will install a barebones Debian server in a VM, with NAT networking (private IP address, no public ports open), for local development/testing purposes only.">
    <meta property="og:url" content="https://book.rymcg.tech/linux-workstation/config/kvm-virt-manager/index.html">
    <meta property="og:site_name" content="book.rymcg.tech">
    <meta property="og:title" content="KVM / libvirt :: book.rymcg.tech">
    <meta property="og:description" content="You can bend the “no servers on workstations” rule, a bit, by hosting some development servers inside of virtual machines (VM) on your workstation. Keeping your development servers in isolated VMs, running under a dedicated VM user account, will keep your workstation clean. You can treat these VMs just like any other remote Linux host, and access them over SSH, and have them automatically start when your workstation boots.
These instructions will install a barebones Debian server in a VM, with NAT networking (private IP address, no public ports open), for local development/testing purposes only.">
    <meta property="og:locale" content="en-us">
    <meta property="og:type" content="article">
    <meta property="article:section" content="Linux Workstation">
    <meta itemprop="name" content="KVM / libvirt :: book.rymcg.tech">
    <meta itemprop="description" content="You can bend the “no servers on workstations” rule, a bit, by hosting some development servers inside of virtual machines (VM) on your workstation. Keeping your development servers in isolated VMs, running under a dedicated VM user account, will keep your workstation clean. You can treat these VMs just like any other remote Linux host, and access them over SSH, and have them automatically start when your workstation boots.
These instructions will install a barebones Debian server in a VM, with NAT networking (private IP address, no public ports open), for local development/testing purposes only.">
    <meta itemprop="wordCount" content="993">
    <title>KVM / libvirt :: book.rymcg.tech</title>
    <link href="/css/fontawesome-all.min.css?1717263913" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="/css/fontawesome-all.min.css?1717263913" rel="stylesheet"></noscript>
    <link href="/css/nucleus.css?1717263913" rel="stylesheet">
    <link href="/css/auto-complete.css?1717263913" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="/css/auto-complete.css?1717263913" rel="stylesheet"></noscript>
    <link href="/css/perfect-scrollbar.min.css?1717263913" rel="stylesheet">
    <link href="/css/fonts.css?1717263913" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="/css/fonts.css?1717263913" rel="stylesheet"></noscript>
    <link href="/css/theme.css?1717263913" rel="stylesheet">
    <link href="/css/theme-zen-auto.css?1717263913" rel="stylesheet" id="R-variant-style">
    <link href="/css/chroma-zen-auto.css?1717263913" rel="stylesheet" id="R-variant-chroma-style">
    <link href="/css/variant.css?1717263913" rel="stylesheet">
    <link href="/css/print.css?1717263913" rel="stylesheet" media="print">
    <script src="/js/variant.js?1717263913"></script>
    <script>
      window.relearn = window.relearn || {};
      window.relearn.relBasePath='..\/..\/..';
      window.relearn.relBaseUri='..\/..\/..';
      window.relearn.absBaseUri='https:\/\/book.rymcg.tech';
      window.index_js_url="/index.search.js";
      // variant stuff
      window.variants && variants.init( [ 'zen-auto', 'zen-light', 'zen-dark', 'relearn-auto', 'relearn-light', 'relearn-dark', 'relearn-bright', 'neon', 'learn', 'blue', 'green', 'red' ] );
      // translations
      window.T_Copy_to_clipboard = `Copy to clipboard`;
      window.T_Copied_to_clipboard = `Copied to clipboard!`;
      window.T_Copy_link_to_clipboard = `Copy link to clipboard`;
      window.T_Link_copied_to_clipboard = `Copied link to clipboard!`;
      window.T_Reset_view = `Reset view`;
      window.T_View_reset = `View reset!`;
      window.T_No_results_found = `No results found for "{0}"`;
      window.T_N_results_found = `{1} results found for "{0}"`;
    </script><link href="/css/custom.css" rel="stylesheet">

  </head>
  <body class="mobile-support html" data-url="/linux-workstation/config/kvm-virt-manager/index.html">
    <div id="R-body" class="default-animation">
      <div id="R-body-overlay"></div>
      <nav id="R-topbar">
        <div class="topbar-wrapper">
          <div class="topbar-sidebar-divider"></div>
          <div class="topbar-area topbar-area-start" data-area="start">
            <div class="topbar-button topbar-button-sidebar" data-content-empty="disable" data-width-s="show" data-width-m="hide" data-width-l="hide"><button class="topbar-control" onclick="toggleNav()" type="button" title="Menu (CTRL&#43;ALT&#43;n)"><i class="fa-fw fas fa-bars"></i></button>
            </div>
            <div class="topbar-button topbar-button-toc" data-content-empty="hide" data-width-s="show" data-width-m="show" data-width-l="show"><button class="topbar-control" onclick="toggleTopbarFlyout(this)" type="button" title="Table of Contents (CTRL&#43;ALT&#43;t)"><i class="fa-fw fas fa-list-alt"></i></button>
              <div class="topbar-content">
                <div class="topbar-content-wrapper"><nav class="TableOfContents">
  <ul>
    <li><a href="#enable-libvirtd">Enable libvirtd</a></li>
    <li><a href="#create-a-dedicated-user-account-for-vm-management">Create a dedicated user account for VM management</a></li>
    <li><a href="#configure-systemd-for-the-libvirt-admin-user">Configure systemd for the libvirt-admin user</a></li>
    <li><a href="#copy-your-public-ssh-key-into-the-libvirt-admin-home-directory">Copy your public SSH key into the libvirt-admin home directory</a></li>
    <li><a href="#create-vm-with-the-libvirt-admin-user">Create VM with the libvirt-admin user</a>
      <ul>
        <li><a href="#run-the-commands-in-this-section-with-the-libvirt-admin-user">Run the commands in this section with the libvirt-admin user</a></li>
        <li><a href="#configure-temporary-variables-for-a-debian-vm-config">Configure temporary variables for a Debian VM config:</a></li>
        <li><a href="#create-directories-to-hold-our-vm-disks-and-config-files">Create directories to hold our VM disks and config files:</a></li>
        <li><a href="#create-the-cloud-init-config-file">Create the cloud-init config file:</a></li>
        <li><a href="#download-the-cloud-image">Download the cloud image:</a></li>
        <li><a href="#clean-up-old-vms-with-the-same-name">Clean up old VMs with the same name:</a></li>
        <li><a href="#create-the-disk-image-for-the-new-vm">Create the disk image for the new VM:</a></li>
        <li><a href="#create-the-vm">Create the VM:</a></li>
        <li><a href="#find-the-ip-address-of-the-vm--named-debian">Find the IP address of the VM (named debian)</a></li>
        <li><a href="#enable-auto-start-on-boot">Enable auto start on boot</a></li>
      </ul>
    </li>
    <li><a href="#vm-management">VM Management</a>
      <ul>
        <li><a href="#list-all-defined-vms">List all defined VMs</a></li>
        <li><a href="#start-vm--named-debian">Start VM (named debian)</a></li>
        <li><a href="#stop-vm--named-debian">Stop VM (named debian)</a></li>
        <li><a href="#undefine-vm--named-debian">Undefine VM (named debian)</a></li>
        <li><a href="#serial-console-of-vm--named-debian">Serial console of VM (named debian)</a></li>
      </ul>
    </li>
    <li><a href="#setup-your-normal-workstation-user-for-ssh-access-to-vm">Setup your normal workstation user for SSH access to VM</a></li>
  </ul>
</nav>
                </div>
              </div>
            </div>
          </div>
          <ol class="topbar-breadcrumbs breadcrumbs highlightable" itemscope itemtype="http://schema.org/BreadcrumbList"><li
            itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement"><a itemprop="item" href="/index.html"><span itemprop="name">book.rymcg.tech</span></a><meta itemprop="position" content="1">&nbsp;>&nbsp;</li><li
            itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement"><a itemprop="item" href="/linux-workstation/index.html"><span itemprop="name">Linux Workstation</span></a><meta itemprop="position" content="2">&nbsp;>&nbsp;</li><li
            itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement"><a itemprop="item" href="/linux-workstation/config/index.html"><span itemprop="name">Config</span></a><meta itemprop="position" content="3">&nbsp;>&nbsp;</li><li
            itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement"><span itemprop="name">KVM / libvirt</span><meta itemprop="position" content="4"></li>
          </ol>
          <div class="topbar-area topbar-area-end" data-area="end">
            <div class="topbar-button topbar-button-prev" data-content-empty="disable" data-width-s="show" data-width-m="show" data-width-l="show"><a class="topbar-control" href="/linux-workstation/config/ssh/index.html" title="SSH (🡐)"><i class="fa-fw fas fa-chevron-left"></i></a>
            </div>
            <div class="topbar-button topbar-button-next" data-content-empty="disable" data-width-s="show" data-width-m="show" data-width-l="show"><a class="topbar-control" href="/d.rymcg.tech/index.html" title="Self-hosting Docker with d.rymcg.tech (🡒)"><i class="fa-fw fas fa-chevron-right"></i></a>
            </div>
            <div class="topbar-button topbar-button-more" data-content-empty="hide" data-width-s="show" data-width-m="show" data-width-l="show"><button class="topbar-control" onclick="toggleTopbarFlyout(this)" type="button" title="More"><i class="fa-fw fas fa-ellipsis-v"></i></button>
              <div class="topbar-content">
                <div class="topbar-content-wrapper">
                  <div class="topbar-area topbar-area-more" data-area="more">
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </nav>
      <div id="R-main-overlay"></div>
      <main id="R-body-inner" class="highlightable default" tabindex="-1">
        <div class="flex-block-wrapper">
          <article class="default">
            <header class="headline">
            </header>

<h1 id="kvm--libvirt">KVM / libvirt</h1>

<p>You can bend the &ldquo;no servers on workstations&rdquo; rule, a bit, by hosting
some development servers inside of virtual machines (VM) on your
workstation. Keeping your development servers in isolated VMs, running
under a dedicated VM user account, will keep your workstation clean.
You can treat these VMs just like any other remote Linux host, and
access them over SSH, and have them automatically start when your
workstation boots.</p>
<p>These instructions will install a barebones Debian server in a VM,
with NAT networking (private IP address, no public ports open), for
local development/testing purposes only.</p>

<nav id="TableOfContents">
  <ul>
    <li><a href="#enable-libvirtd">Enable libvirtd</a></li>
    <li><a href="#create-a-dedicated-user-account-for-vm-management">Create a dedicated user account for VM management</a></li>
    <li><a href="#configure-systemd-for-the-libvirt-admin-user">Configure systemd for the libvirt-admin user</a></li>
    <li><a href="#copy-your-public-ssh-key-into-the-libvirt-admin-home-directory">Copy your public SSH key into the libvirt-admin home directory</a></li>
    <li><a href="#create-vm-with-the-libvirt-admin-user">Create VM with the libvirt-admin user</a>
      <ul>
        <li><a href="#run-the-commands-in-this-section-with-the-libvirt-admin-user">Run the commands in this section with the libvirt-admin user</a></li>
        <li><a href="#configure-temporary-variables-for-a-debian-vm-config">Configure temporary variables for a Debian VM config:</a></li>
        <li><a href="#create-directories-to-hold-our-vm-disks-and-config-files">Create directories to hold our VM disks and config files:</a></li>
        <li><a href="#create-the-cloud-init-config-file">Create the cloud-init config file:</a></li>
        <li><a href="#download-the-cloud-image">Download the cloud image:</a></li>
        <li><a href="#clean-up-old-vms-with-the-same-name">Clean up old VMs with the same name:</a></li>
        <li><a href="#create-the-disk-image-for-the-new-vm">Create the disk image for the new VM:</a></li>
        <li><a href="#create-the-vm">Create the VM:</a></li>
        <li><a href="#find-the-ip-address-of-the-vm--named-debian">Find the IP address of the VM (named debian)</a></li>
        <li><a href="#enable-auto-start-on-boot">Enable auto start on boot</a></li>
      </ul>
    </li>
    <li><a href="#vm-management">VM Management</a>
      <ul>
        <li><a href="#list-all-defined-vms">List all defined VMs</a></li>
        <li><a href="#start-vm--named-debian">Start VM (named debian)</a></li>
        <li><a href="#stop-vm--named-debian">Stop VM (named debian)</a></li>
        <li><a href="#undefine-vm--named-debian">Undefine VM (named debian)</a></li>
        <li><a href="#serial-console-of-vm--named-debian">Serial console of VM (named debian)</a></li>
      </ul>
    </li>
    <li><a href="#setup-your-normal-workstation-user-for-ssh-access-to-vm">Setup your normal workstation user for SSH access to VM</a></li>
  </ul>
</nav>



<h2 id="enable-libvirtd">Enable libvirtd</h2>

<div class="box notices cstyle tip">
  <div class="box-label"><i class="fa-fw fas fa-lightbulb"></i> Tip</div>
  <div class="box-content">

<p>This depends on the libvirt packages installed in the chapter on <a href="/linux-workstation/layering-packages/index.html">Layering packages</a>.</p>
</div>
</div>


<div class="box notices cstyle run">
    <div class="box-label primary">
        <i class="fa-fw fas fa-dollar-sign"></i>[bash]: Run this on your workstation:</div>
    <div class="box-content">
        <code><pre>
sudo systemctl enable --now libvirtd
sudo systemctl status libvirtd
</pre></code>
    </div>
</div>


<p>Add the existing <code>libvirt</code> group to <code>/etc/group</code> :</p>


<div class="box notices cstyle run">
    <div class="box-label primary">
        <i class="fa-fw fas fa-dollar-sign"></i>[bash]: Run this on your workstation:</div>
    <div class="box-content">
        <code><pre>
sudo bash -c "getent group libvirt >> /etc/group"
</pre></code>
    </div>
</div>


<aside>
<p>(I&rsquo;m not sure why Fedora Atomic doesn&rsquo;t do this automatically. The
group and GID exists, it just isn&rsquo;t added to <code>/etc/group</code>
automatically.)</p>
</aside>
<h2 id="create-a-dedicated-user-account-for-vm-management">Create a dedicated user account for VM management</h2>


<div class="box notices cstyle run">
    <div class="box-label primary">
        <i class="fa-fw fas fa-dollar-sign"></i>[bash]: Run this on your workstation:</div>
    <div class="box-content">
        <code><pre>
VM_ADMIN=libvirt-admin
sudo useradd ${VM_ADMIN} -G libvirt
</pre></code>
    </div>
</div>


<h2 id="configure-systemd-for-the-libvirt-admin-user">Configure systemd for the libvirt-admin user</h2>


<div class="box notices cstyle run">
    <div class="box-label primary">
        <i class="fa-fw fas fa-dollar-sign"></i>[bash]: Run this on your workstation:</div>
    <div class="box-content">
        <code><pre>
sudo loginctl enable-linger ${VM_ADMIN}
sudo su ${VM_ADMIN} -c "mkdir -p ~/.bashrc.d"
sudo su ${VM_ADMIN} -c "echo export XDG_RUNTIME_DIR=/run/user/\$(id -u) > ~/.bashrc.d/xdg"
</pre></code>
    </div>
</div>


<h2 id="copy-your-public-ssh-key-into-the-libvirt-admin-home-directory">Copy your public SSH key into the libvirt-admin home directory</h2>


<div class="box notices cstyle run">
    <div class="box-label primary">
        <i class="fa-fw fas fa-dollar-sign"></i>[bash]: Run this on your workstation:</div>
    <div class="box-content">
        <code><pre>
SSH_KEY=~/.ssh/id_ed25519.pub
TMP_SSH=$(mktemp)
cat ${SSH_KEY} > ${TMP_SSH}
chmod a+r ${TMP_SSH}
sudo su ${VM_ADMIN:-libvirt-admin} -c "mkdir -p ~/libvirt && cp ${TMP_SSH} ~/libvirt/user-ssh.pub"
</pre></code>
    </div>
</div>


<h2 id="create-vm-with-the-libvirt-admin-user">Create VM with the libvirt-admin user</h2>
<h3 id="run-the-commands-in-this-section-with-the-libvirt-admin-user">Run the commands in this section with the libvirt-admin user</h3>

<div class="box notices cstyle info">
  <div class="box-label"><i class="fa-fw fas fa-info-circle"></i> Info</div>
  <div class="box-content">

<p><strong>For this entire section you need to perform the VM config as the <code>libvirt-admin</code> user.</strong></p>
<p>Login to the shell account of  <code>libvirt-admin</code>:</p>
<div class="box notices cstyle run">
    <div class="box-label primary">
        <i class="fa-fw fas fa-dollar-sign"></i>[bash]: Run this on your workstation:</div>
    <div class="box-content">
        <code><pre>
sudo su -l ${VM_ADMIN:-libvirt-admin}
</pre></code>
    </div>
</div>
</div>
</div>
<h3 id="configure-temporary-variables-for-a-debian-vm-config">Configure temporary variables for a Debian VM config:</h3>
<div class="box notices cstyle edit env">
    <div class="box-label"><i class="fa-fw fas fa-keyboard"></i>[bash]: Customize and set temporary environment variables</div>
    <div class="box-content">
        <code><pre>
CLOUD_IMAGE=https://cloud.debian.org/images/cloud/bookworm/latest/debian-12-generic-amd64.qcow2
NAME=debian
OS_VARIANT=debian12
MEMORY=1024
CPUS=2
DISK_SIZE=50
MAC_ADDRESS=$(printf '00:60:2F:%02X:%02X:%02X\n' $[RANDOM%256] $[RANDOM%256] $[RANDOM%256])
USER_DATA=~/libvirt/cloud-init/${NAME}.yaml
</pre></code>
    </div>
</div>
<h3 id="create-directories-to-hold-our-vm-disks-and-config-files">Create directories to hold our VM disks and config files:</h3>


<div class="box notices cstyle run">
    <div class="box-label secondary">
        <i class="fa-fw fas fa-dollar-sign"></i>Run this as the libvirt-admin user</div>
    <div class="box-content">
        <code><pre>
mkdir -p ~/libvirt/{cloud-images,disks,cloud-init}
</pre></code>
    </div>
</div>


<h3 id="create-the-cloud-init-config-file">Create the cloud-init config file:</h3>


<div class="box notices cstyle run">
    <div class="box-label secondary">
        <i class="fa-fw fas fa-dollar-sign"></i>Run this as the libvirt-admin user</div>
    <div class="box-content">
        <code><pre>
cat << EOF | sed 's/\xe2\x80\x8b//g' > ${USER_DATA}
#cloud-config
hostname: ${NAME}
users:
​  - name: admin
    ssh_authorized_keys:
​      - $(cat ~/libvirt/user-ssh.pub)
    sudo: ALL=(ALL) NOPASSWD:ALL
EOF
</pre></code>
    </div>
</div>


<h3 id="download-the-cloud-image">Download the cloud image:</h3>

<div class="box notices cstyle tip">
  <div class="box-label"><i class="fa-fw fas fa-lightbulb"></i> Tip</div>
  <div class="box-content">

<p>You only need to download each CLOUD_IMAGE once, they will be cached
in <code>~/libvirt/cloud-images</code>, so they can be be reused.</p>
</div>
</div>


<div class="box notices cstyle run">
    <div class="box-label secondary">
        <i class="fa-fw fas fa-dollar-sign"></i>Run this as the libvirt-admin user</div>
    <div class="box-content">
        <code><pre>
(cd ~/libvirt/cloud-images; curl -LO ${CLOUD_IMAGE})
chmod a-w ~/libvirt/cloud-images/$(echo ${CLOUD_IMAGE} | grep -Po ".*/\K.*$")
</pre></code>
    </div>
</div>


<h3 id="clean-up-old-vms-with-the-same-name">Clean up old VMs with the same name:</h3>

<div class="box notices cstyle warning">
  <div class="box-label"><i class="fa-fw fas fa-exclamation-triangle"></i> Warning</div>
  <div class="box-content">

<p>If you already have a VM with the same name, and you want to start
again from scratch, you need to clean up from the previous install
first:</p>
<div class="box notices cstyle run">
    <div class="box-label secondary">
        <i class="fa-fw fas fa-dollar-sign"></i>Run this as the libvirt-admin user</div>
    <div class="box-content">
        <code><pre>
\# To cleanup up and REMOVE an old VM named debian:
virsh destroy debian
virsh managedsave-remove debian
virsh undefine debian
</pre></code>
    </div>
</div>
</div>
</div>
<h3 id="create-the-disk-image-for-the-new-vm">Create the disk image for the new VM:</h3>

<div class="box notices cstyle warning">
  <div class="box-label"><i class="fa-fw fas fa-exclamation-triangle"></i> Warning</div>
  <div class="box-content">

<p>This is destructive of the existing disk file!</p>
</div>
</div>


<div class="box notices cstyle run">
    <div class="box-label secondary">
        <i class="fa-fw fas fa-dollar-sign"></i>Run this as the libvirt-admin user</div>
    <div class="box-content">
        <code><pre>
(set -e
cp ~/libvirt/cloud-images/$(echo ${CLOUD_IMAGE} | grep -Po ".*/\K.*") \
   ~/libvirt/disks/${NAME}.qcow2
chmod u+w ~/libvirt/disks/${NAME}.qcow2
qemu-img resize ~/libvirt/disks/${NAME}.qcow2 +${DISK_SIZE}G
echo Created ~/libvirt/disks/${NAME}.qcow2
)
</pre></code>
    </div>
</div>


<h3 id="create-the-vm">Create the VM:</h3>


<div class="box notices cstyle run">
    <div class="box-label primary">
        <i class="fa-fw fas fa-dollar-sign"></i>[bash]: Run this on your workstation:</div>
    <div class="box-content">
        <code><pre>
virt-install \
  --name ${NAME} \
  --os-variant ${OS_VARIANT} \
  --virt-type kvm \
  --graphics none \
  --console pty,target_type=serial \
  --noautoconsole \
  --cpu host \
  --vcpus ${CPUS} \
  --memory ${MEMORY} \
  --network bridge=virbr0,model=virtio,mac=${MAC_ADDRESS} \
  --cloud-init user-data=${USER_DATA} \
  --import \
  --disk ~/libvirt/disks/${NAME}.qcow2
</pre></code>
    </div>
</div>


<ul>
<li>Wait a minute for the VM to boot and bring up its network interface.</li>
</ul>
<h3 id="find-the-ip-address-of-the-vm--named-debian">Find the IP address of the VM (named debian)</h3>


<div class="box notices cstyle run">
    <div class="box-label tip">
        <i class="fa-fw fas fa-dollar-sign"></i>[bash]: Run this on your workstation:</div>
    <div class="box-content">
        <code><pre>
NAME=debian
MAC_ADDRESS=$(virsh domiflist ${NAME} | grep virbr0 | grep -Po ".* \K.*$")
arp -n | grep $MAC_ADDRESS | cut -d " " -f 1
</pre></code>
    </div>
</div>


<h3 id="enable-auto-start-on-boot">Enable auto start on boot</h3>


<div class="box notices cstyle run">
    <div class="box-label primary">
        <i class="fa-fw fas fa-dollar-sign"></i>[bash]: Run this on your workstation:</div>
    <div class="box-content">
        <code><pre>
NAME=debian
virsh autostart ${NAME}
</pre></code>
    </div>
</div>


<h2 id="vm-management">VM Management</h2>
<h3 id="list-all-defined-vms">List all defined VMs</h3>


<div class="box notices cstyle run">
    <div class="box-label primary">
        <i class="fa-fw fas fa-dollar-sign"></i>[bash]: Run this on your workstation:</div>
    <div class="box-content">
        <code><pre>
virsh list -all
</pre></code>
    </div>
</div>


<div class="box notices cstyle stdout">
    <div class="box-label">(stdout)</div>
    <div class="box-content">
        <pre>
​ Id   Name     State
​------------------------
​ 5    debian   running
</pre>
    </div>
</div>

<h3 id="start-vm--named-debian">Start VM (named debian)</h3>


<div class="box notices cstyle run">
    <div class="box-label primary">
        <i class="fa-fw fas fa-dollar-sign"></i>[bash]: Run this on your workstation:</div>
    <div class="box-content">
        <code><pre>
virsh start debian
</pre></code>
    </div>
</div>


<h3 id="stop-vm--named-debian">Stop VM (named debian)</h3>


<div class="box notices cstyle run">
    <div class="box-label primary">
        <i class="fa-fw fas fa-dollar-sign"></i>[bash]: Run this on your workstation:</div>
    <div class="box-content">
        <code><pre>
​# destroy actually just means stop, not delete
virsh destroy debian
</pre></code>
    </div>
</div>


<h3 id="undefine-vm--named-debian">Undefine VM (named debian)</h3>


<div class="box notices cstyle run">
    <div class="box-label primary">
        <i class="fa-fw fas fa-dollar-sign"></i>[bash]: Run this on your workstation:</div>
    <div class="box-content">
        <code><pre>
​# undefine removes the VM configuration
virsh undefine debian
</pre></code>
    </div>
</div>


<h3 id="serial-console-of-vm--named-debian">Serial console of VM (named debian)</h3>


<div class="box notices cstyle run">
    <div class="box-label primary">
        <i class="fa-fw fas fa-dollar-sign"></i>[bash]: Run this on your workstation:</div>
    <div class="box-content">
        <code><pre>
virsh console debian
</pre></code>
    </div>
</div>


<p>To exit the console, press <code>Ctrl-]</code>. (Control + right square bracket).</p>
<h2 id="setup-your-normal-workstation-user-for-ssh-access-to-vm">Setup your normal workstation user for SSH access to VM</h2>

<div class="box notices cstyle info">
  <div class="box-label"><i class="fa-fw fas fa-info-circle"></i> Info</div>
  <div class="box-content">

<p><strong>For this section, you are back to using your normal workstation user.</strong></p>
</div>
</div>
<p>Edit your <code>~/.ssh/config</code> and create a new config entry for the VM:</p>
<div class="box notices cstyle edit">
    <div class="box-label"><i class="fa-fw fas fa-keyboard"></i>Edit this file: ~/.ssh/config</div>
    <div class="box-content">
        <code><pre>
Host debian
    Hostname 192.168.122.42
    User admin
    ControlMaster auto
    ControlPersist yes
    ControlPath /tmp/ssh-%u-%r@%h:%p
</pre></code>
    </div>
</div>

<p>With this config, you can now use SSH to control the VM:</p>


<div class="box notices cstyle run">
    <div class="box-label primary">
        <i class="fa-fw fas fa-dollar-sign"></i>[bash]: Run this on your workstation:</div>
    <div class="box-content">
        <code><pre>
ssh debian whoami
</pre></code>
    </div>
</div>


<p>It is recommended to install Docker on your Debian VM. Please read the
other book on <a href="/d.rymcg.tech/index.html">Self-hosting Docker</a>, and the chapter on <a href="/d.rymcg.tech/workstation/install-docker-on-remote-host/index.html">installing Docker</a></p>

            <footer class="footline">
            </footer>
          </article>
        </div>
      </main>
    </div>
    <aside id="R-sidebar" class="default-animation">
      <div id="R-header-topbar" class="default-animation"></div>
      <div id="R-header-wrapper" class="default-animation">
        <div id="R-header" class="default-animation">
<img src="/img/logo.jpg" class="logo" />

        </div>

        <search><form action="/search.html" method="get">
          <div class="searchbox default-animation">
            <button class="search-detail" type="submit" title="Search (CTRL+ALT+f)"><i class="fas fa-search"></i></button>
            <label class="a11y-only" for="R-search-by">Search</label>
            <input data-search-input id="R-search-by" name="search-by" class="search-by" type="search" placeholder="Search...">
            <button class="search-clear" type="button" data-search-clear="" title="Clear search"><i class="fas fa-times" title="Clear search"></i></button>
          </div>
        </form></search>
        <script>
          var contentLangs=['en'];
        </script>
        <script src="/js/auto-complete.js?1717263913" defer></script>
        <script src="/js/lunr/lunr.min.js?1717263913" defer></script>
        <script src="/js/lunr/lunr.stemmer.support.min.js?1717263913" defer></script>
        <script src="/js/lunr/lunr.multi.min.js?1717263913" defer></script>
        <script src="/js/lunr/lunr.en.min.js?1717263913" defer></script>
        <script src="/js/search.js?1717263913" defer></script>
      </div>
      <div id="R-homelinks" class="default-animation homelinks">
        <ul>
          <li><a class="padding" href="/index.html"><i class="fa-fw fas fa-home"></i> Home</a></li>
        </ul>
        <hr class="padding">
      </div>
      <div id="R-content-wrapper" class="highlightable">
        <div id="R-topics">
          <ul class="enlarge morespace collapsible-menu">
          <li data-nav-id="/linux-workstation/index.html" class="parent "><a class="padding" href="/linux-workstation/index.html">Linux Workstation</a><ul id="R-subsections-4fabcc8bf6f43bc84cc33c8d9fe1b62b" class="morespace collapsible-menu">
          <li data-nav-id="/linux-workstation/introduction/index.html" class="alwaysopen"><a class="padding" href="/linux-workstation/introduction/index.html">Introduction</a><ul id="R-subsections-247caeb1441bcea844a3ccf766ca4471" class="morespace collapsible-menu">
          <li data-nav-id="/linux-workstation/introduction/fedora-sway-atomic/index.html" class=""><a class="padding" href="/linux-workstation/introduction/fedora-sway-atomic/index.html">Fedora Sway Atomic</a></li>
          <li data-nav-id="/linux-workstation/introduction/requirements/index.html" class=""><a class="padding" href="/linux-workstation/introduction/requirements/index.html">Requirements</a></li></ul></li>
          <li data-nav-id="/linux-workstation/install/index.html" class=""><a class="padding" href="/linux-workstation/install/index.html">Install Linux (Fedora Atomic)</a></li>
          <li data-nav-id="/linux-workstation/upgrading/index.html" class=""><a class="padding" href="/linux-workstation/upgrading/index.html">Upgrading</a></li>
          <li data-nav-id="/linux-workstation/layering-packages/index.html" class=""><a class="padding" href="/linux-workstation/layering-packages/index.html">Layering packages</a></li>
          <li data-nav-id="/linux-workstation/config/index.html" class="parent alwaysopen"><a class="padding" href="/linux-workstation/config/index.html">Config</a><ul id="R-subsections-51edac90ba33828eb61f7465c11b4244" class="morespace collapsible-menu">
          <li data-nav-id="/linux-workstation/config/sway/index.html" class=""><a class="padding" href="/linux-workstation/config/sway/index.html">Sway</a></li>
          <li data-nav-id="/linux-workstation/config/firefox/index.html" class=""><a class="padding" href="/linux-workstation/config/firefox/index.html">Firefox</a></li>
          <li data-nav-id="/linux-workstation/config/toolbox/index.html" class=""><a class="padding" href="/linux-workstation/config/toolbox/index.html">Toolbox</a></li>
          <li data-nav-id="/linux-workstation/config/emacs-on-fedora/index.html" class=""><a class="padding" href="/linux-workstation/config/emacs-on-fedora/index.html">Emacs</a></li>
          <li data-nav-id="/linux-workstation/config/ssh/index.html" class=""><a class="padding" href="/linux-workstation/config/ssh/index.html">SSH</a></li>
          <li data-nav-id="/linux-workstation/config/kvm-virt-manager/index.html" class="active"><a class="padding" href="/linux-workstation/config/kvm-virt-manager/index.html">KVM / libvirt</a></li></ul></li></ul></li>
          <li data-nav-id="/d.rymcg.tech/index.html" class=""><a class="padding" href="/d.rymcg.tech/index.html">Self-hosting Docker</a><ul id="R-subsections-8a053662b5014ad6ad1762206cc0e2f9" class="morespace collapsible-menu">
          <li data-nav-id="/d.rymcg.tech/introduction/index.html" class=""><a class="padding" href="/d.rymcg.tech/introduction/index.html">Introduction</a></li>
          <li data-nav-id="/d.rymcg.tech/required-infrastructure/index.html" class="alwaysopen"><a class="padding" href="/d.rymcg.tech/required-infrastructure/index.html">Required Infrastructure</a><ul id="R-subsections-850ccad8337ba16ba7e92d565f4fea56" class="morespace collapsible-menu">
          <li data-nav-id="/d.rymcg.tech/required-infrastructure/register-a-domain-nameom/index.html" class=""><a class="padding" href="/d.rymcg.tech/required-infrastructure/register-a-domain-nameom/index.html">Register a domain name</a></li>
          <li data-nav-id="/d.rymcg.tech/required-infrastructure/setup-dns/index.html" class=""><a class="padding" href="/d.rymcg.tech/required-infrastructure/setup-dns/index.html">Setup public DNS service</a></li>
          <li data-nav-id="/d.rymcg.tech/required-infrastructure/public-docker-server/index.html" class=""><a class="padding" href="/d.rymcg.tech/required-infrastructure/public-docker-server/index.html">Create a public server (VPS)</a></li></ul></li>
          <li data-nav-id="/d.rymcg.tech/workstation/index.html" class="alwaysopen"><a class="padding" href="/d.rymcg.tech/workstation/index.html">Setup your workstation</a><ul id="R-subsections-4a12c34b2fece93fc397ecf3de950464" class="morespace collapsible-menu">
          <li data-nav-id="/d.rymcg.tech/workstation/install-docker-command-line-tools/index.html" class=""><a class="padding" href="/d.rymcg.tech/workstation/install-docker-command-line-tools/index.html">Install Docker client tools</a></li>
          <li data-nav-id="/d.rymcg.tech/workstation/install-d-rymcg-tech/index.html" class=""><a class="padding" href="/d.rymcg.tech/workstation/install-d-rymcg-tech/index.html">Install d.rymcg.tech tools</a></li>
          <li data-nav-id="/d.rymcg.tech/workstation/ssh-config-and-docker-context/index.html" class=""><a class="padding" href="/d.rymcg.tech/workstation/ssh-config-and-docker-context/index.html">Create SSH config and Docker Context</a></li>
          <li data-nav-id="/d.rymcg.tech/workstation/install-docker-on-remote-host/index.html" class=""><a class="padding" href="/d.rymcg.tech/workstation/install-docker-on-remote-host/index.html">Install Docker on your remote host</a></li>
          <li data-nav-id="/d.rymcg.tech/workstation/main-config-for-d.rymcg/index.html" class=""><a class="padding" href="/d.rymcg.tech/workstation/main-config-for-d.rymcg/index.html">Main config for d.rymcg.tech</a></li></ul></li>
          <li data-nav-id="/d.rymcg.tech/install-traefik-proxy/index.html" class=""><a class="padding" href="/d.rymcg.tech/install-traefik-proxy/index.html">Install Traefik Proxy</a></li>
          <li data-nav-id="/d.rymcg.tech/whoami/index.html" class=""><a class="padding" href="/d.rymcg.tech/whoami/index.html">Whoami</a></li></ul></li>
          <li data-nav-id="/publishing-with-org-mode/index.html" class=""><a class="padding" href="/publishing-with-org-mode/index.html">Publishing with org-mode</a><ul id="R-subsections-415a59a995a98556d7692b05dd8d304c" class="morespace collapsible-menu">
          <li data-nav-id="/publishing-with-org-mode/dependencies/index.html" class=""><a class="padding" href="/publishing-with-org-mode/dependencies/index.html">Dependencies</a></li>
          <li data-nav-id="/publishing-with-org-mode/building-locally/index.html" class=""><a class="padding" href="/publishing-with-org-mode/building-locally/index.html">Building locally</a></li>
          <li data-nav-id="/publishing-with-org-mode/publish-with-github-pages/index.html" class=""><a class="padding" href="/publishing-with-org-mode/publish-with-github-pages/index.html">Publishing with GitHub pages</a></li>
          <li data-nav-id="/publishing-with-org-mode/publish-with-sftp/index.html" class=""><a class="padding" href="/publishing-with-org-mode/publish-with-sftp/index.html">Publishing with SFTP</a></li>
          <li data-nav-id="/publishing-with-org-mode/examples/index.html" class="alwaysopen"><a class="padding" href="/publishing-with-org-mode/examples/index.html">Example Org / Hugo content</a><ul id="R-subsections-21525f33c1956ce3844918973388ff0a" class="morespace collapsible-menu">
          <li data-nav-id="/publishing-with-org-mode/examples/org-blocks/index.html" class=""><a class="padding" href="/publishing-with-org-mode/examples/org-blocks/index.html">Example Org Blocks</a></li>
          <li data-nav-id="/publishing-with-org-mode/examples/shortcodes/index.html" class=""><a class="padding" href="/publishing-with-org-mode/examples/shortcodes/index.html">Example Shortcodes</a></li>
          <li data-nav-id="/publishing-with-org-mode/examples/deeply/index.html" class="alwaysopen"><a class="padding" href="/publishing-with-org-mode/examples/deeply/index.html">Example of a deeply …</a><ul id="R-subsections-5c8cebe1226c6de44ad55152efdb64aa" class="morespace collapsible-menu">
          <li data-nav-id="/publishing-with-org-mode/examples/deeply/nested/index.html" class="alwaysopen"><a class="padding" href="/publishing-with-org-mode/examples/deeply/nested/index.html">Nested …</a><ul id="R-subsections-b3d8d366e5b04e51fbfcb8de77d01482" class="morespace collapsible-menu">
          <li data-nav-id="/publishing-with-org-mode/examples/deeply/nested/subchapters/subchapter1/index.html" class=""><a class="padding" href="/publishing-with-org-mode/examples/deeply/nested/subchapters/subchapter1/index.html">Sub-chapter 1</a></li>
          <li data-nav-id="/publishing-with-org-mode/examples/deeply/nested/subchapters/subchapter2/index.html" class=""><a class="padding" href="/publishing-with-org-mode/examples/deeply/nested/subchapters/subchapter2/index.html">Sub-chapter 2</a></li>
          <li data-nav-id="/publishing-with-org-mode/examples/deeply/nested/subchapters/subchapter3/index.html" class=""><a class="padding" href="/publishing-with-org-mode/examples/deeply/nested/subchapters/subchapter3/index.html">Sub-chapter 3</a></li></ul></li></ul></li></ul></li></ul></li>
          <li data-nav-id="/license/index.html" class=""><a class="padding" href="/license/index.html">LICENSE</a></li>
          </ul>
        </div>
        <div class="padding footermargin footerLangSwitch footerVariantSwitch footerVisitedLinks footerFooter showVariantSwitch showFooter"></div>
        <div id="R-menu-footer">
          <hr class="padding default-animation footerLangSwitch footerVariantSwitch footerVisitedLinks footerFooter showVariantSwitch showFooter">
          <div id="R-prefooter" class="footerLangSwitch footerVariantSwitch footerVisitedLinks showVariantSwitch">
            <ul>
              <li id="R-select-language-container" class="footerLangSwitch">
                <div class="padding menu-control">
                  <i class="fa-fw fas fa-language"></i>
                  <span>&nbsp;</span>
                  <div class="control-style">
                    <label class="a11y-only" for="R-select-language">Language</label>
                    <select id="R-select-language" onchange="location = this.querySelector( this.value ).dataset.url;">
                      <option id="R-select-language-en" value="#R-select-language-en" data-url="/linux-workstation/config/kvm-virt-manager/index.html" lang="en-us" selected></option>
                    </select>
                  </div>
                  <div class="clear"></div>
                </div>
              </li>
              <li id="R-select-variant-container" class="footerVariantSwitch showVariantSwitch">
                <div class="padding menu-control">
                  <i class="fa-fw fas fa-paint-brush"></i>
                  <span>&nbsp;</span>
                  <div class="control-style">
                    <label class="a11y-only" for="R-select-variant">Theme</label>
                    <select id="R-select-variant" onchange="window.variants && variants.changeVariant( this.value );">
                      <option id="R-select-variant-zen-auto" value="zen-auto" selected>Zen Light/Dark</option>
                      <option id="R-select-variant-zen-light" value="zen-light">Zen Light</option>
                      <option id="R-select-variant-zen-dark" value="zen-dark">Zen Dark</option>
                      <option id="R-select-variant-relearn-auto" value="relearn-auto">Relearn Light/Dark</option>
                      <option id="R-select-variant-relearn-light" value="relearn-light">Relearn Light</option>
                      <option id="R-select-variant-relearn-dark" value="relearn-dark">Relearn Dark</option>
                      <option id="R-select-variant-relearn-bright" value="relearn-bright">Relearn Bright</option>
                      <option id="R-select-variant-neon" value="neon">Neon</option>
                      <option id="R-select-variant-learn" value="learn">Learn</option>
                      <option id="R-select-variant-blue" value="blue">Blue</option>
                      <option id="R-select-variant-green" value="green">Green</option>
                      <option id="R-select-variant-red" value="red">Red</option>
                    </select>
                  </div>
                  <div class="clear"></div>
                </div>
                <script>window.variants && variants.markSelectedVariant();</script>
              </li>
              <li class="footerVisitedLinks">
                <div class="padding menu-control">
                  <i class="fa-fw fas fa-history"></i>
                  <span>&nbsp;</span>
                  <div class="control-style">
                    <button onclick="clearHistory();">Clear History</button>
                  </div>
                  <div class="clear"></div>
                </div>
              </li>
            </ul>
          </div>
          <div id="R-footer" class="footerFooter showFooter">Build: Jun 1, 2024 at 5:45pm (UTC)

          </div>
        </div>
      </div>
    </aside>
    <script src="/js/clipboard.min.js?1717263913" defer></script>
    <script src="/js/perfect-scrollbar.min.js?1717263913" defer></script>
    <script src="/js/theme.js?1717263913" defer></script>
  </body>
</html>
